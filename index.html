<div style="position: relative; display: inline-block; width: 100%; max-width: 800px;">
  <!-- Video -->
  <video id="video" controls autoplay style="width: 100%; height: auto; background: black;"></video>

  <!-- Logotip -->
  <img src="https://raw.githubusercontent.com/umidjonqaxxorov624-lgtm/telegram-stream/main/logo.png"
       style="position: absolute; top: 10px; right: 10px; width: 100px; opacity: 0.9; pointer-events: none;" />

  <!-- Sifat tanlash -->
  <select id="qualitySelect" 
          style="position:absolute; bottom:10px; right:10px; z-index:10; padding:5px;">
    <option value="auto">Auto</option>
  </select>

  <!-- Toâ€˜liq ekran tugmasi -->
  <button onclick="toggleFullScreen()" 
          style="position:absolute; bottom:10px; left:10px; z-index:10; padding:5px;">
    Fullscreen
  </button>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
  var video = document.getElementById('video');
  var qualitySelect = document.getElementById('qualitySelect');
  var streamUrl = "https://soft-sea-814f.umidjonqaxxorov624.workers.dev/";

  if (Hls.isSupported()) {
    var hls = new Hls();
    hls.loadSource(streamUrl);
    hls.attachMedia(video);

    hls.on(Hls.Events.MANIFEST_PARSED, function (event, data) {
      console.log("Mavjud sifatlar:", data.levels);
      data.levels.forEach((level, index) => {
        if (level.height >= 240) { // faqat 240p dan yuqori
          var option = document.createElement("option");
          option.value = index;
          option.text = level.height + "p";
          qualitySelect.appendChild(option);
        }
      });
    });

    qualitySelect.addEventListener("change", function () {
      if (this.value === "auto") {
        hls.currentLevel = -1;
      } else {
        hls.currentLevel = parseInt(this.value);
      }
    });
  } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
    video.src = streamUrl;
    video.play();
  }

  // Fullscreen funksiyasi
  function toggleFullScreen() {
    if (!document.fullscreenElement) {
      video.requestFullscreen().catch(err => {
        alert("Fullscreen ishlamadi: " + err.message);
      });
    } else {
      document.exitFullscreen();
    }
  }
</script>
